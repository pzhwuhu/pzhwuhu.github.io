<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="light"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/avatar_1.jpg"><link rel="icon" href="/img/avatar_1.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="pzhwuhu"><meta name="keywords" content=""><meta name="description" content="这是2025年北航OO第二单元的总结博客，希望能对你有所帮助😊              魔鬼般的OO-Unit2终于结束啦😭😭😭😁😁😁     进入正题    这是三次迭代后hw7的代码行数统计，源代码行数762行，应该算少的吧 这也反映出本人力求简洁的迭代追求，能少写的就少写，几行代码就能解决的问题绝不去卷高深复杂的方法 下面是本单元的总结与分析  同步"><meta property="og:type" content="article"><meta property="og:title" content="BUAA-OO-Unit2"><meta property="og:url" content="http://pzhwuhu.github.io/2025/04/18/OO-Unit2/index.html"><meta property="og:site_name" content="鹏哥"><meta property="og:description" content="这是2025年北航OO第二单元的总结博客，希望能对你有所帮助😊              魔鬼般的OO-Unit2终于结束啦😭😭😭😁😁😁     进入正题    这是三次迭代后hw7的代码行数统计，源代码行数762行，应该算少的吧 这也反映出本人力求简洁的迭代追求，能少写的就少写，几行代码就能解决的问题绝不去卷高深复杂的方法 下面是本单元的总结与分析  同步"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://pzhwuhu.github.io/myimg/%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%9711.jpg"><meta property="article:published_time" content="2025-04-18T12:22:30.000Z"><meta property="article:modified_time" content="2025-04-18T12:51:55.566Z"><meta property="article:author" content="pzhwuhu"><meta property="article:tag" content="OO"><meta property="article:tag" content="Java"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://pzhwuhu.github.io/myimg/%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%9711.jpg"><title>BUAA-OO-Unit2 - 鹏哥</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom_dark_mode.css"><link rel="stylesheet" href="/css/scroll_animation.css"><link rel="stylesheet" href="/css/mac.css"><link rel="stylesheet" href="/css/loading.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/gradient.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"pzhwuhu.github.io",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:{key:null},google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:"cp3oK6SJdvk7QCx0TiMpNSdI-gzGzoHsz",app_key:"B9u5rSWtXwzrQl56fuCE0o9M",server_url:"https://cp3ok6sj.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>if(!Fluid.ctx.dnt){var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?[object Object]";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()}</script><meta name="generator" content="Hexo 7.3.0"></head><body><header><div class="header-inner" style="height:90vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>身如芥子，心藏须弥</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url('/myimg/%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%973.jpg') no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="BUAA-OO-Unit2"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> pzhwuhu </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-04-18 20:22" pubdate>2025年4月18日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.6k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 31 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div><div class="scroll-down-bar"><i class="iconfont icon-arrowdown"></i></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="OO" id="heading-e48bf9dad3f5d442f9d14d931be6f43e" role="tab" data-toggle="collapse" href="#collapse-e48bf9dad3f5d442f9d14d931be6f43e" aria-expanded="true">OO <span class="list-group-count">(4)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-e48bf9dad3f5d442f9d14d931be6f43e" role="tabpanel" aria-labelledby="heading-e48bf9dad3f5d442f9d14d931be6f43e"><div class="category-post-list"><a href="/2025/03/22/OO-Unit1/" title="BUAA-OO-Unit1" class="list-group-item list-group-item-action"><span class="category-post">BUAA-OO-Unit1</span> </a><a href="/2025/04/18/OO-Unit2/" title="BUAA-OO-Unit2" class="list-group-item list-group-item-action active"><span class="category-post">BUAA-OO-Unit2</span> </a><a href="/2025/05/14/OO-Unit3/" title="BUAA-OO-Unit3" class="list-group-item list-group-item-action"><span class="category-post">BUAA-OO-Unit3</span> </a><a href="/2024/11/09/OOpre%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/" title="BUAA-OOpre课程总结" class="list-group-item list-group-item-action"><span class="category-post">BUAA-OOpre课程总结</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">BUAA-OO-Unit2</h1><div class="markdown-body"><div class="note note-info"><p>这是2025年北航OO第二单元的总结博客，希望能对你有所帮助😊</p></div><ul><li>魔鬼般的OO-Unit2终于结束啦😭😭😭😁😁😁</li></ul><p><img src="https://cdn.jsdelivr.net/gh/pzhwuhu/Image-Hosting/Posts%20insert/%E9%BE%99%E7%8C%AB3.jpg" srcset="/img/loading.gif" lazyload alt="龙猫3"></p><hr><ul><li>进入正题</li></ul><p><img src="https://cdn.jsdelivr.net/gh/pzhwuhu/Image-Hosting/Posts%20insert/image-20250418125328192.png" srcset="/img/loading.gif" lazyload></p><ul><li>这是三次迭代后<code>hw7</code>的代码行数统计，源代码行数762行，应该算少的吧</li><li>这也反映出本人<strong>力求简洁的迭代追求</strong>，<del>能少写的就少写</del>，几行代码就能解决的问题绝不去卷高深复杂的方法</li><li>下面是本单元的<strong>总结与分析</strong></li></ul><h1 id="同步块与锁的选择"><a href="#同步块与锁的选择" class="headerlink" title="同步块与锁的选择"></a>同步块与锁的选择</h1><p>我们为什么需要同步块？因为多个线程同时运行时可能会对同一共享资源进行访问和修改，这样就会造成<strong>竞争与同步问题</strong>，因此我们需要锁和同步块来解决这一问题。</p><p>在我的代码中，hw5最开始我有一个<code>MainRequests</code>主类和<code>SubRequests</code>子类，后来我发现这两个类里面的属性和方法竟然一模一样(●’◡’●)，后面索性就只有<code>Requests</code>这一个类了</p><ul><li>因为<code>Requests</code>类被<code>inputThread</code>和<code>DispatchThread</code>所共享，因此这两个类中对<code>Requests</code>类调用的方法都需要加锁，设置同步块，具体如下：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sortByPriority</span><span class="hljs-params">()</span> &#123;<br>       requests.sort(Comparator.comparingInt(r -&gt; ((PersonRequest) r).getPriority()).reversed());<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(Request request)</span> &#123;<br>       <span class="hljs-comment">//TimableOutput.println(&quot;from-&quot; + elevatorId + &quot;-request need</span><br>       <span class="hljs-comment">// to be dispatched-&quot; + isDone() + &quot;-&quot; + isEmpty());</span><br>       requests.add(request);<br>       notifyAll();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Request <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">if</span> (!isDone() &amp;&amp; isEmpty()) &#123;<br>           <span class="hljs-keyword">try</span> &#123;<br>               wait();<br>           &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>               <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>           &#125;<br>       &#125;<br>       <span class="hljs-keyword">if</span> (isEmpty()) &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br>       notifyAll();<br>       <span class="hljs-keyword">return</span> requests.remove(<span class="hljs-number">0</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDone</span><span class="hljs-params">()</span> &#123;<br>       done = <span class="hljs-literal">true</span>;<br>       notifyAll();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDone</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> done &amp; (arrivedRequests == needRequests.size());<br>       <span class="hljs-comment">//return done;</span><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> requests.isEmpty();<br>   &#125;<br></code></pre></td></tr></table></figure><ul><li>此外还有电梯线程中，在临时调度到达目的地需要将人请下去时，需要<strong>设置同步块，保证这是一个原子操作</strong>，在这个过程不允许分派线程再将请求添加给电梯的请求队列中</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheOutPerson</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (subRequests) &#123;<br>            Iterator&lt;Request&gt; iterator = subRequests.getRequests().iterator();<br>            <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                <span class="hljs-type">PersonRequest</span> <span class="hljs-variable">preq</span> <span class="hljs-operator">=</span> (PersonRequest)iterator.next();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">strFloor</span> <span class="hljs-operator">=</span> Strategy.toStr(floor);<br>                <span class="hljs-type">int</span> <span class="hljs-variable">toFloor</span> <span class="hljs-operator">=</span> Strategy.toInt(preq.getToFloor());<br>                <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> preq.getPersonId();<br>                <span class="hljs-keyword">if</span> (peopleInEle.contains(id)) &#123;<br>                    people--;<br>                    peopleInEle.remove(Integer.valueOf(id));<br>                    <span class="hljs-keyword">if</span> (toFloor == floor) &#123;<br>                        iterator.remove();<br>                        mainRequests.addArrive();<br>                        TimableOutput.println(<span class="hljs-string">&quot;OUT-S-&quot;</span> + id + <span class="hljs-string">&quot;-&quot;</span> + strFloor + <span class="hljs-string">&quot;-&quot;</span> + elevatorId);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-type">ReArrangeRequest</span> <span class="hljs-variable">raq</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReArrangeRequest</span>(floor, preq);<br>                        TimableOutput.println(<span class="hljs-string">&quot;OUT-F-&quot;</span> + id + <span class="hljs-string">&quot;-&quot;</span> + strFloor + <span class="hljs-string">&quot;-&quot;</span> + elevatorId);<br>                        mainRequests.push(raq);<br>                        iterator.remove();<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="调度分配策略"><a href="#调度分配策略" class="headerlink" title="调度分配策略"></a>调度分配策略</h1><h2 id="hw5"><a href="#hw5" class="headerlink" title="hw5"></a>hw5</h2><ul><li>hw5的请求是指定了电梯的，因此直接分配给对应编号的电梯即可，无需过多设计</li></ul><h2 id="hw6"><a href="#hw6" class="headerlink" title="hw6"></a>hw6</h2><ul><li><p>最开始我的设计是将所有的主请求按照 1 2 3 ……6 1 2 ……的循环&#x3D;&#x3D;顺序分配&#x3D;&#x3D;给6部电梯，这样的设计比较简单，而且在大量的请求加持下，性能也不会很差劲，写法大致如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">personDispatch</span><span class="hljs-params">(PersonRequest request)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">elevatorId</span> <span class="hljs-operator">=</span> inOrder();<br>        subRequestMap.get(elevatorId).push(request);<br>        TimableOutput.println(<span class="hljs-string">&quot;RECEIVE-&quot;</span> + request.getPersonId() + <span class="hljs-string">&quot;-&quot;</span> + elevatorId);<br>    &#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">inOrder</span><span class="hljs-params">()</span> &#123;<br>        counter++;<br>        counter %= <span class="hljs-number">6</span>;<br>        <span class="hljs-keyword">return</span> counter + <span class="hljs-number">1</span>;<br>    &#125;<br></code></pre></td></tr></table></figure></li><li><p>但随后发现hw6新增了临时调度，<strong>临时调度期间的电梯无法进行分配</strong>，因此在分配调度时必须要考虑电梯是否在临时调度，这也<strong>会带来一系列问题</strong>：</p><ul><li>遇到了临时调度的电梯怎么办，是等待它结束还是重新分派一个新的电梯呢？</li><li>如果所有的电梯都临时调度了，怎么办？</li></ul><p>我的策略是遇到了临时调度的电梯，就遍历电梯，找一个<code>Free</code>的电梯分配给它，如果没有电梯<code>Free</code>，则随机决定一个电梯并等它结束临时调度。</p><p>这里有一个<strong>很经典也很有趣</strong>的问题，如果5部电梯都临时调度，并且在同一时间来了大量请求，那么是否要将这些请求全部分配给那一个空闲的电梯呢？这就是&#x3D;&#x3D;经典的围师必阙问题&#x3D;&#x3D;，也是中测mid5的测试意图，如果盲目地全部塞给一个电梯，那么其他电梯结束临时调度后无事可干，但这个电梯后面很有可能吃不消，最终导致<code>TLE</code>，因此我们还需要加一些逻辑，比如<strong>设定一个最高分配上限</strong>，我设计的是20，当然你也完全可以设置为其他你认为合适的值。把之前的判断加一个条件即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (subRequestMap.get(i).getFree() &amp;&amp; subRequestMap.get(i).getSize() &lt; <span class="hljs-number">20</span>)<br></code></pre></td></tr></table></figure><p>我的调度器的核心代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">personDispatch</span><span class="hljs-params">(PersonRequest request)</span> &#123;<br>        counter++;<br>        counter %= <span class="hljs-number">6</span>;<br>        <span class="hljs-type">Requests</span> <span class="hljs-variable">requests</span> <span class="hljs-operator">=</span> subRequestMap.get(counter + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">synchronized</span> (requests) &#123;<br>            <span class="hljs-keyword">if</span> (!requests.getFree()) &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">6</span>;i++) &#123;<br>                    <span class="hljs-keyword">synchronized</span> (subRequestMap.get(i)) &#123;<br>                        <span class="hljs-keyword">if</span> (subRequestMap.get(i).getFree() &amp;&amp; subRequestMap.get(i).getSize() &lt; <span class="hljs-number">20</span>) &#123;<br>                            TimableOutput.println(<span class="hljs-string">&quot;RECEIVE-&quot;</span> + request.getPersonId() + <span class="hljs-string">&quot;-&quot;</span> + i);<br>                            subRequestMap.get(i).push(request);<br>                            <span class="hljs-keyword">return</span>; &#125;<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                TimableOutput.println(<span class="hljs-string">&quot;RECEIVE-&quot;</span> + request.getPersonId() + <span class="hljs-string">&quot;-&quot;</span> + (counter + <span class="hljs-number">1</span>));<br>                subRequestMap.get(counter + <span class="hljs-number">1</span>).push(request);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>    	<span class="hljs-comment">//all elevators are not free</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> random();<br>        requests = subRequestMap.get(random);<br>        <span class="hljs-keyword">synchronized</span> (requests) &#123;<br>            <span class="hljs-keyword">while</span> (!requests.getFree()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    requests.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e); &#125;<br>            &#125;<br>            TimableOutput.println(<span class="hljs-string">&quot;RECEIVE-&quot;</span> + request.getPersonId() + <span class="hljs-string">&quot;-&quot;</span> + random);<br>            subRequestMap.get(random).push(request);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="hw7"><a href="#hw7" class="headerlink" title="hw7"></a>hw7</h2><ul><li>在hw6中我们的分派策略已经相对完善了，<strong>我们此时只需要考虑哪些地方变了，根据需要增加条件即可</strong></li><li>不难发现，如果采用<code>LOCK</code>运行策略，那么在经过<code>UPDATE</code>改造后决不能给电梯分配一个无法到达的请求，我们在分配时还需要获取电梯可到达楼层范围的属性，在我的设计中，可到达范围由一个<code>int</code>型的共享楼层和一个<code>boolean</code>型的是否为A属性来表征。如果为A，也就是电梯改造后在上面运行的电梯，那么运行范围就是共享楼层到顶楼，反之就是底层到共享楼层</li><li>明白了hw7中变化的地方后，我们<strong>在每次分配前，还需要判断该电梯是否可到达</strong>，具体来说，如下</li><li>我给电梯的共享楼层属性默认值为100，则未改造前，电梯可到达B4-F7任意楼层，因此直接返回true。下面的判断主要由两种情况，一种是请求的起始楼层无法到达，另一种是起始楼层是共享楼层，但终点无法到达</li><li>之后再分配的条件里加上这个<code>isInRange</code>的判断即可</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInRange</span><span class="hljs-params">(<span class="hljs-type">int</span> eleId, PersonRequest request)</span> &#123;<br>        <span class="hljs-type">ElevatorThread</span> <span class="hljs-variable">ele</span> <span class="hljs-operator">=</span> elevatorMap.get(eleId);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sharedFloor</span> <span class="hljs-operator">=</span> ele.getSharedFloor();<br>        <span class="hljs-keyword">if</span> (sharedFloor == <span class="hljs-number">100</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">fromFloor</span> <span class="hljs-operator">=</span> Strategy.toInt(request.getFromFloor());<br>            <span class="hljs-type">int</span> <span class="hljs-variable">toFloor</span> <span class="hljs-operator">=</span> Strategy.toInt(request.getToFloor());<br>            <span class="hljs-keyword">if</span> (ele.isA()) &#123;<br>                <span class="hljs-keyword">if</span> (fromFloor &gt; sharedFloor) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fromFloor == sharedFloor) &#123;<br>                    <span class="hljs-keyword">return</span> toFloor &gt; sharedFloor;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (fromFloor &lt; sharedFloor) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fromFloor == sharedFloor) &#123;<br>                    <span class="hljs-keyword">return</span> toFloor &lt; sharedFloor;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><p>强测的请求数量一般比较多，而且很多是同一时间投放的，<strong>因此个人觉得无论是采用随机分配还是顺序分配，性能都不会太差</strong>，也无需去卷影子电梯了，而且影子电梯在hw7中的修改似乎还比较麻烦，有不少hw6成功实现影子电梯的同学在hw7中放弃了影子电梯，因为模拟的难度比较大，而且可能还有别的bug。<strong>而本人的这种杂糅随机分配和顺序分配的方式，在hw7的强测中，性能也还不错</strong>😁没有<code>WA</code>的点基本都是94-96之间（WA了两个点。。。😭）</p><h1 id="协作图"><a href="#协作图" class="headerlink" title="协作图"></a>协作图</h1><p><img src="https://cdn.jsdelivr.net/gh/pzhwuhu/Image-Hosting/Posts%20insert/Unit2_seq-%E7%94%B5%E6%A2%AF%E7%B3%BB%E7%BB%9F%E5%8D%8F%E4%BD%9C%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt="Unit2_seq-电梯系统协作图"></p><h2 id="稳定内容"><a href="#稳定内容" class="headerlink" title="稳定内容"></a>稳定内容</h2><ul><li>整体架构，<code>MainClass</code> –&gt; <code>Inputthread</code> –&gt; <code>DispatchThread</code> –&gt; <code>ElevatorThread</code></li><li>电梯运行策略：<code>LOOK</code>算法</li><li>电梯运行架构：<code>Strategy</code> –&gt; <code>Action</code> –&gt; <code>Elevator</code></li></ul><h2 id="变化内容"><a href="#变化内容" class="headerlink" title="变化内容"></a>变化内容</h2><ul><li>分派策略：指定电梯 –&gt; 混合策略</li><li>结束逻辑： hw6以后的线程结束需要增加逻辑，详见后面的bug分析部分</li><li>电梯运行限制增加，hw7有了楼层限制，共享层进入限制</li></ul><h1 id="双轿厢与共享楼层"><a href="#双轿厢与共享楼层" class="headerlink" title="双轿厢与共享楼层"></a>双轿厢与共享楼层</h1><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><ul><li>双轿厢输出<code>begin</code>必须要等两部电梯都把人清空完毕，这就需要建立电梯线程之间的通信机制，这也是之前的架构与设计中所没有的内容。</li><li>那么如何建立这种通信机制呢？如果将电梯视为主、子电梯，直接将子电梯的属性或者子电梯本身暴露给主电梯，这样的设计或许实现起来不难，但是却违背了设计的初衷与简洁性，将一个电梯线程暴露给另一个电梯线程，也不符合直觉与常理。</li><li>那么，要想实现两电梯线程之间的痛心，就<strong>得有一个共享对象</strong>，然后由这个共享对象来监听电梯的状态，然后输出<code>begin</code>和<code>end</code>。这里我们&#x3D;&#x3D;把共享楼层作为一种共享资源，建立一个协作类-Coordinate&#x3D;&#x3D;</li><li>在这个协作类中，不仅可以实现双轿厢改造，还可以实现对共享楼层的互斥访问</li></ul><h2 id="双轿厢改造"><a href="#双轿厢改造" class="headerlink" title="双轿厢改造"></a>双轿厢改造</h2><ul><li>在输入类读取到双轿厢改造请求时，实例化一个coordinate对象并将其传递给两个电梯线程</li><li>在电梯线程内进行改造时，按照如下步骤：<ul><li>free置为false，<strong>不再添加请求</strong></li><li>将电梯内的人赶下去，赶完后通过coordinate的方法<code>setReady()</code><strong>告诉</strong>协作类准备好了</li><li>电梯线程准备好后即开始<strong>等待</strong>另一个电梯准备，在协作类中收到两个电梯准备好的信号后即输出<code>UPDATE-BEGIN-</code> 并<strong>唤醒</strong>等待的电梯线程</li><li>电梯进行改造，设置楼层、速度（其实可以提到前面就完成改造）</li><li><strong>告诉</strong>协作类改造好了并开始等待，协作类收到两个电梯改造好的信号后即输出<code>UPDATE-END-</code>并且<strong>唤醒</strong>等待的电梯线程</li><li>改造完毕，free置为true</li></ul></li></ul><h2 id="共享楼层互斥"><a href="#共享楼层互斥" class="headerlink" title="共享楼层互斥"></a>共享楼层互斥</h2><ul><li>在进入共享楼层前查询是否已被占用，如果是则等待</li><li>退出共享楼层前释放锁</li><li>就这么简单</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Coordinate.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inShared</span><span class="hljs-params">( )</span> &#123;<br>        <span class="hljs-keyword">if</span> (isbusy) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                wait();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>        isbusy = <span class="hljs-literal">true</span>;<br>    &#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outShared</span><span class="hljs-params">( )</span> &#123;<br>    isbusy = <span class="hljs-literal">false</span>;<br>    notifyAll();<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h1><h2 id="hw5-1"><a href="#hw5-1" class="headerlink" title="hw5"></a>hw5</h2><ul><li>hw5大部分人都很漂亮，没有bug，而我重蹈第一单元的覆辙，犯了一个愚蠢的错误：<strong>没有控制电梯内人数小于等于6</strong></li><li>好笑吧，确实有点幽默了😆😆</li></ul><h2 id="hw6-1"><a href="#hw6-1" class="headerlink" title="hw6"></a>hw6</h2><ul><li><p>最大的bug是<strong>两条语句的顺序反了</strong>，，导致我强测爆了近一半的点，气死我了😭😭</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">mainRequests.push(raq);<br>TimableOutput.println(<span class="hljs-string">&quot;OUT-F-&quot;</span> + id + <span class="hljs-string">&quot;-&quot;</span> + strFloor + <span class="hljs-string">&quot;-&quot;</span> + elevatorId);<br></code></pre></td></tr></table></figure><ul><li>这是我&#x3D;&#x3D;错误的代码&#x3D;&#x3D;，在乘客尚未到达目的地而下电梯的时候，我先将其送回了主请求队列，再进行了输出</li><li>如果分派器很快地将这个请求分派给其他电梯，则到导致该乘客还未下电梯就重新分配了</li><li>将这两条语句换一下顺序即可</li></ul></li><li><p>这里我不得不提一嘴，凡是涉及到输出的地方，都&#x3D;&#x3D;一定要认真认真再认真地检查语句的执行顺序是否有潜在隐患&#x3D;&#x3D;，不然就会像我一样寄掉</p></li><li><p>还有一个值得一提的是&#x3D;&#x3D;程序结束的问题&#x3D;&#x3D;，在hw5中主请求对列为空且输入线程结束，那么分派器线程也就结束了，但是本次hw6不一样，可能在主请求对列为空且输入线程结束后，还会有人被电梯“遣送”回住请求队列，如果此时分派器线程已经结束，那么这个人就被抛弃了😆，因此需要统计所有要送的乘客数和已到达的乘客数，二者相等才能结束</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDone</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> done &amp; (arrivedRequests == needRequests.size());<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="hw7-1"><a href="#hw7-1" class="headerlink" title="hw7"></a>hw7</h2><ul><li>没什么特别的bug</li></ul><h2 id="debug方法"><a href="#debug方法" class="headerlink" title="debug方法"></a>debug方法</h2><ul><li>如果有精力有兴趣，最好自己或者与别人合作&#x3D;&#x3D;搭建评测机&#x3D;&#x3D;。从数据的生成，到批量运行测试点，再到评测结果与性能，自己一个人还是有些费力的，如果搭建了一个数据够强，覆盖全面，并且能正确评测，批量运行的评测机。相信我，你肯定能找出你的bug。当然，<del>如果你能要到别人的评测机，坐享其成也是不错的</del></li><li>在调试过程中，本人最擅长的还是&#x3D;&#x3D;print大法&#x3D;&#x3D;，在各个关键节点，将你所需要的信息统统打印出来，这样可以轻松判断<ul><li>数据是否正确，状态是否正确</li><li>分支进入是否符合预期</li><li>线程是否等待、被唤醒、结束</li><li>……</li></ul></li><li>如果程序无法结束或者死锁了，我建议用睿睿的输入类结合重定向输入，然后<strong>在IDEA里面调试</strong>，可以查看各个线程的状态。其他情况还是建议用课程组提供的官方输入包运行，毕竟二者行为可能会不一样。</li><li>&#x3D;&#x3D;多和室友、朋友、同学交流，别自己闭门造车&#x3D;&#x3D;，很多时候大家都在踩同样的坑或者你踩的坑别人早就踩过啦</li></ul><h1 id="心得体会"><a href="#心得体会" class="headerlink" title="心得体会"></a>心得体会</h1><ul><li>从最初对多线程一无所知到现在勉强能写个简单的多线程程序，我在第二单元还是学会了很多新的东西，<strong>对多线程编程、同步与互斥，并发、数据竞争</strong>等有了进一步的更深的理解。</li><li>Unit2也让我对线程安全有了更深刻的理解，以后的业务方向毫无疑问大部分都是多线程的问题，这时候线程的安全、数据读取的安全就尤为重要，必须要对共享资源的读写进行保护，除了基本的<code>synchronized</code>与<code>notifyAll</code>，我们还可以用读写锁来实现更高的效率与性能。当然，还有更多更高深的方法等待我去学习</li><li>印象最深的还是本单元每周五的通宵debug时刻，我<strong>清楚地记得</strong><ul><li>hw5的周五我一直de到第二天早上4点</li><li>hw6几乎占据了整个清明假期，最后也是在第三天凌晨2点通过了中测</li><li>hw7我周五晚上才开始写，直接通宵了，到第二天5点通过中测，浑然不知天已经亮了</li></ul></li><li>我也在社交平台上每周发一篇帖子，写下自己对OO的抱怨、对debug痛苦的倾诉、对压力的宣泄，也得到了很多学长学姐的鼓励与指导（甚至还有U2猪脚）</li></ul><h1 id="鸣谢❤️"><a href="#鸣谢❤️" class="headerlink" title="鸣谢❤️"></a>鸣谢❤️</h1><ul><li><strong>感谢OO课程组的老师以及可爱的助教们</strong></li><li><strong>感谢与我讨论架构、交流bug、分享经验的朋友们</strong></li><li><strong>感谢一起搭建评测机的室友小哥哥</strong></li><li><strong>感谢给予我温暖与鼓励的学长学姐们</strong></li><li><strong>感谢一路奋斗、顽强拼搏的自己</strong></li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/OO/" class="category-chain-item">OO</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/OO/" class="print-no-link">#OO</a> <a href="/tags/Java/" class="print-no-link">#Java</a></div></div><div class="license-box my-3"><div class="license-title"><div>BUAA-OO-Unit2</div><div>http://pzhwuhu.github.io/2025/04/18/OO-Unit2/</div></div><div class="license-meta"><div class="license-meta-item"><div>本文作者</div><div>pzhwuhu</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2025年4月18日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2025年4月18日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-cc-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-cc-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2025/05/14/OO-Unit3/" title="BUAA-OO-Unit3"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">BUAA-OO-Unit3</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2025/03/31/%E4%B8%AA%E4%BA%BA%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA/" title="个人图床搭建"><span class="hidden-mobile">个人图床搭建</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script>Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",(function(){var i=Object.assign({appId:"cp3oK6SJdvk7QCx0TiMpNSdI-gzGzoHsz",appKey:"B9u5rSWtXwzrQl56fuCE0o9M",path:"window.location.pathname",placeholder:"留下你的足迹吧，超多emoji可用噢，qq邮箱自动获取头像",avatar:"robohash",meta:["nick","mail","link"],requiredFields:["nick"],pageSize:10,lang:"zh-CN",highlight:!0,recordIP:!0,serverURLs:"",emojiCDN:"https://valine-emoji.bili33.top/",emojiMaps:{bilibilitv2:"bilibilitv/[tv_doge].png",bilibilitv3:"bilibilitv/[tv_亲亲].png",bilibilitv4:"bilibilitv/[tv_偷笑].png",bilibilitv5:"bilibilitv/[tv_再见].png",bilibilitv6:"bilibilitv/[tv_冷漠].png",bilibilitv7:"bilibilitv/[tv_发怒].png",bilibilitv8:"bilibilitv/[tv_发财].png",bilibilitv9:"bilibilitv/[tv_可爱].png",bilibilitv10:"bilibilitv/[tv_吐血].png",bilibilitv11:"bilibilitv/[tv_呆].png",bilibilitv12:"bilibilitv/[tv_呕吐].png",bilibilitv13:"bilibilitv/[tv_困].png",bilibilitv14:"bilibilitv/[tv_坏笑].png",bilibilitv15:"bilibilitv/[tv_大佬].png",bilibilitv16:"bilibilitv/[tv_大哭].png",bilibilitv17:"bilibilitv/[tv_委屈].png",bilibilitv18:"bilibilitv/[tv_害羞].png",bilibilitv19:"bilibilitv/[tv_尴尬].png",bilibilitv20:"bilibilitv/[tv_微笑].png",bilibilitv21:"bilibilitv/[tv_思考].png",bilibilitv22:"bilibilitv/[tv_惊吓].png",bilibilitv23:"bilibilitv/[tv_打脸].png",bilibilitv24:"bilibilitv/[tv_抓狂].png",bilibilitv25:"bilibilitv/[tv_抠鼻].png",bilibilitv26:"bilibilitv/[tv_斜眼笑].png",bilibilitv27:"bilibilitv/[tv_无奈].png",bilibilitv28:"bilibilitv/[tv_晕].png",bilibilitv29:"bilibilitv/[tv_流汗].png",bilibilitv30:"bilibilitv/[tv_流泪].png",bilibilitv31:"bilibilitv/[tv_流鼻血].png",bilibilitv32:"bilibilitv/[tv_点赞].png",bilibilitv33:"bilibilitv/[tv_生气].png",bilibilitv34:"bilibilitv/[tv_生病].png",bilibilitv35:"bilibilitv/[tv_疑问].png",bilibilitv36:"bilibilitv/[tv_白眼].png",bilibilitv37:"bilibilitv/[tv_皱眉].png",bilibilitv38:"bilibilitv/[tv_目瞪口呆].png",bilibilitv39:"bilibilitv/[tv_睡着].png",bilibilitv40:"bilibilitv/[tv_笑哭].png",bilibilitv41:"bilibilitv/[tv_腼腆].png",bilibilitv42:"bilibilitv/[tv_色].png",bilibilitv43:"bilibilitv/[tv_调侃].png",bilibilitv44:"bilibilitv/[tv_调皮].png",bilibilitv45:"bilibilitv/[tv_鄙视].png",bilibilitv46:"bilibilitv/[tv_闭嘴].png",bilibilitv47:"bilibilitv/[tv_难过].png",bilibilitv48:"bilibilitv/[tv_馋].png",bilibilitv49:"bilibilitv/[tv_鬼脸].png",bilibilitv50:"bilibilitv/[tv_黑人问号].png",bilibilitv51:"bilibilitv/[tv_鼓掌].png",bilibili22332:"bilibili2233/[2233娘_卖萌].png",bilibili22333:"bilibili2233/[2233娘_吃惊].png",bilibili22334:"bilibili2233/[2233娘_吐魂].png",bilibili22335:"bilibili2233/[2233娘_喝水].png",bilibili22336:"bilibili2233/[2233娘_困惑].png",bilibili22337:"bilibili2233/[2233娘_大哭].png",bilibili22338:"bilibili2233/[2233娘_大笑].png",bilibili22339:"bilibili2233/[2233娘_委屈].png",bilibili223310:"bilibili2233/[2233娘_怒].png",bilibili223311:"bilibili2233/[2233娘_无言].png",bilibili223312:"bilibili2233/[2233娘_汗].png",bilibili223313:"bilibili2233/[2233娘_疑问].png",bilibili223314:"bilibili2233/[2233娘_第一].png",bilibili223315:"bilibili2233/[2233娘_耶].png",bilibili223316:"bilibili2233/[2233娘_郁闷].png","Tieba-New2":"Tieba-New/image_emoticon.png","Tieba-New3":"Tieba-New/image_emoticon10.png","Tieba-New4":"Tieba-New/image_emoticon100.png","Tieba-New14":"Tieba-New/image_emoticon11.png","Tieba-New31":"Tieba-New/image_emoticon13.png","Tieba-New32":"Tieba-New/image_emoticon14.png","Tieba-New33":"Tieba-New/image_emoticon15.png","Tieba-New34":"Tieba-New/image_emoticon16.png","Tieba-New35":"Tieba-New/image_emoticon17.png","Tieba-New36":"Tieba-New/image_emoticon18.png","Tieba-New37":"Tieba-New/image_emoticon19.png","Tieba-New38":"Tieba-New/image_emoticon2.png","Tieba-New39":"Tieba-New/image_emoticon20.png","Tieba-New40":"Tieba-New/image_emoticon21.png","Tieba-New41":"Tieba-New/image_emoticon22.png","Tieba-New42":"Tieba-New/image_emoticon23.png","Tieba-New43":"Tieba-New/image_emoticon24.png","Tieba-New44":"Tieba-New/image_emoticon25.png","Tieba-New45":"Tieba-New/image_emoticon26.png","Tieba-New46":"Tieba-New/image_emoticon27.png","Tieba-New47":"Tieba-New/image_emoticon28.png","Tieba-New48":"Tieba-New/image_emoticon29.png","Tieba-New49":"Tieba-New/image_emoticon3.png","Tieba-New50":"Tieba-New/image_emoticon30.png","Tieba-New51":"Tieba-New/image_emoticon31.png","Tieba-New52":"Tieba-New/image_emoticon32.png","Tieba-New53":"Tieba-New/image_emoticon33.png","Tieba-New54":"Tieba-New/image_emoticon34.png","Tieba-New55":"Tieba-New/image_emoticon35.png","Tieba-New56":"Tieba-New/image_emoticon36.png","Tieba-New57":"Tieba-New/image_emoticon37.png","Tieba-New58":"Tieba-New/image_emoticon38.png","Tieba-New59":"Tieba-New/image_emoticon39.png","Tieba-New60":"Tieba-New/image_emoticon4.png","Tieba-New61":"Tieba-New/image_emoticon40.png","Tieba-New62":"Tieba-New/image_emoticon41.png","Tieba-New63":"Tieba-New/image_emoticon42.png","Tieba-New64":"Tieba-New/image_emoticon43.png","Tieba-New65":"Tieba-New/image_emoticon44.png","Tieba-New66":"Tieba-New/image_emoticon45.png","Tieba-New67":"Tieba-New/image_emoticon46.png","Tieba-New68":"Tieba-New/image_emoticon47.png","Tieba-New69":"Tieba-New/image_emoticon48.png","Tieba-New70":"Tieba-New/image_emoticon49.png","Tieba-New71":"Tieba-New/image_emoticon5.png","Tieba-New72":"Tieba-New/image_emoticon50.png","Tieba-New73":"Tieba-New/image_emoticon6.png","Tieba-New74":"Tieba-New/image_emoticon66.png","Tieba-New75":"Tieba-New/image_emoticon67.png","Tieba-New76":"Tieba-New/image_emoticon68.png","Tieba-New77":"Tieba-New/image_emoticon69.png","Tieba-New78":"Tieba-New/image_emoticon7.png","Tieba-New79":"Tieba-New/image_emoticon70.png","Tieba-New80":"Tieba-New/image_emoticon71.png","Tieba-New81":"Tieba-New/image_emoticon72.png","Tieba-New82":"Tieba-New/image_emoticon73.png","Tieba-New83":"Tieba-New/image_emoticon74.png","Tieba-New84":"Tieba-New/image_emoticon75.png","Tieba-New85":"Tieba-New/image_emoticon76.png","Tieba-New86":"Tieba-New/image_emoticon77.png","Tieba-New87":"Tieba-New/image_emoticon78.png","Tieba-New88":"Tieba-New/image_emoticon79.png","Tieba-New89":"Tieba-New/image_emoticon8.png","Tieba-New90":"Tieba-New/image_emoticon80.png","Tieba-New91":"Tieba-New/image_emoticon81.png","Tieba-New92":"Tieba-New/image_emoticon82.png","Tieba-New93":"Tieba-New/image_emoticon83.png","Tieba-New94":"Tieba-New/image_emoticon84.png","Tieba-New95":"Tieba-New/image_emoticon85.png","Tieba-New96":"Tieba-New/image_emoticon86.png","Tieba-New97":"Tieba-New/image_emoticon87.png","Tieba-New98":"Tieba-New/image_emoticon88.png","Tieba-New99":"Tieba-New/image_emoticon89.png","Tieba-New100":"Tieba-New/image_emoticon9.png","Tieba-New101":"Tieba-New/image_emoticon90.png","Tieba-New102":"Tieba-New/image_emoticon91.png","Tieba-New103":"Tieba-New/image_emoticon92.png","Tieba-New104":"Tieba-New/image_emoticon93.png","Tieba-New105":"Tieba-New/image_emoticon94.png","Tieba-New106":"Tieba-New/image_emoticon95.png","Tieba-New107":"Tieba-New/image_emoticon96.png","Tieba-New108":"Tieba-New/image_emoticon97.png","Tieba-New109":"Tieba-New/image_emoticon98.png","Tieba-New110":"Tieba-New/image_emoticon99.png",weibo2:"weibo/d_aoteman.png",weibo15:"weibo/d_doge.png",weibo16:"weibo/d_erha.png",weibo40:"weibo/d_miao.png",weibo49:"weibo/d_shenshou.png",weibo65:"weibo/d_xiongmao.png",weibo74:"weibo/d_zhutou.png",weibo75:"weibo/d_zuiyou.png",weibo76:"weibo/emoji_0x1f31f.png",weibo77:"weibo/emoji_0x1f349.png",weibo78:"weibo/emoji_0x1f357.png",weibo79:"weibo/emoji_0x1f384.png",weibo80:"weibo/emoji_0x1f44f.png",weibo81:"weibo/emoji_0x1f47b.png",weibo82:"weibo/emoji_0x1f47f.png",weibo83:"weibo/emoji_0x1f48a.png",weibo84:"weibo/emoji_0x1f4a3.png",weibo85:"weibo/emoji_0x1f4a9.png",weibo86:"weibo/emoji_0x1f631.png",weibo87:"weibo/emoji_0x1f643.png",weibo88:"weibo/emoji_0x1f645.png",weibo89:"weibo/emoji_0x1f648.png",weibo90:"weibo/emoji_0x1f649.png",weibo91:"weibo/emoji_0x1f64a.png",weibo92:"weibo/emoji_0x1f64b.png",weibo93:"weibo/emoji_0x1f64f.png",weibo94:"weibo/emoji_0x1f913.png",weibo95:"weibo/emoji_0x1f917.png",weibo96:"weibo/emoji_0x26a1.png",weibo97:"weibo/h_buyao.png",weibo98:"weibo/h_good.png",weibo99:"weibo/h_haha.png",weibo100:"weibo/h_jiayou.png",weibo101:"weibo/h_lai.png",weibo102:"weibo/h_ok.png",weibo103:"weibo/h_quantou.png",weibo105:"weibo/h_woshou.png",weibo106:"weibo/h_ye.png",weibo107:"weibo/h_zan.png",weibo108:"weibo/h_zuoyi.png","HONKAI3-Star1":"HONKAI3-Star/1.gif","HONKAI3-Star2":"HONKAI3-Star/10.gif","HONKAI3-Star3":"HONKAI3-Star/11.gif","HONKAI3-Star4":"HONKAI3-Star/12.gif","HONKAI3-Star5":"HONKAI3-Star/13.gif","HONKAI3-Star6":"HONKAI3-Star/14.gif","HONKAI3-Star7":"HONKAI3-Star/15.gif","HONKAI3-Star8":"HONKAI3-Star/16.gif","HONKAI3-Star9":"HONKAI3-Star/2.gif","HONKAI3-Star10":"HONKAI3-Star/3.gif","HONKAI3-Star11":"HONKAI3-Star/4.gif","HONKAI3-Star12":"HONKAI3-Star/5.gif","HONKAI3-Star13":"HONKAI3-Star/6.gif","HONKAI3-Star14":"HONKAI3-Star/7.gif","HONKAI3-Star15":"HONKAI3-Star/8.gif","HONKAI3-Star16":"HONKAI3-Star/9.gif","HONKAI3-Daily1":"HONKAI3-Daily/1.gif","HONKAI3-Daily2":"HONKAI3-Daily/10.gif","HONKAI3-Daily3":"HONKAI3-Daily/11.gif","HONKAI3-Daily4":"HONKAI3-Daily/12.gif","HONKAI3-Daily5":"HONKAI3-Daily/13.gif","HONKAI3-Daily6":"HONKAI3-Daily/14.gif","HONKAI3-Daily7":"HONKAI3-Daily/15.gif","HONKAI3-Daily8":"HONKAI3-Daily/16.gif","HONKAI3-Daily9":"HONKAI3-Daily/2.gif","HONKAI3-Daily10":"HONKAI3-Daily/3.gif","HONKAI3-Daily11":"HONKAI3-Daily/4.gif","HONKAI3-Daily12":"HONKAI3-Daily/5.gif","HONKAI3-Daily13":"HONKAI3-Daily/6.gif","HONKAI3-Daily14":"HONKAI3-Daily/7.gif","HONKAI3-Daily15":"HONKAI3-Daily/8.gif","HONKAI3-Daily16":"HONKAI3-Daily/9.gif","Tsuri-me-ju_mimi1":"Tsuri-me-ju_mimi/10753776_key@2x.png","Tsuri-me-ju_mimi2":"Tsuri-me-ju_mimi/10753777_key@2x.png","Tsuri-me-ju_mimi3":"Tsuri-me-ju_mimi/10753778_key@2x.png","Tsuri-me-ju_mimi12":"Tsuri-me-ju_mimi/10753787_key@2x.png","Tsuri-me-ju_mimi13":"Tsuri-me-ju_mimi/10753788_key@2x.png","Tsuri-me-ju_mimi14":"Tsuri-me-ju_mimi/10753789_key@2x.png","Tsuri-me-ju_mimi15":"Tsuri-me-ju_mimi/10753790_key@2x.png","Tsuri-me-ju_mimi16":"Tsuri-me-ju_mimi/10753791_key@2x.png","Tsuri-me-ju_mimi36":"Tsuri-me-ju_mimi/10753811_key@2x.png","Tsuri-me-ju_mimi37":"Tsuri-me-ju_mimi/10753812_key@2x.png","Tsuri-me-ju_mimi38":"Tsuri-me-ju_mimi/10753813_key@2x.png","Tsuri-me-ju_mimi40":"Tsuri-me-ju_mimi/10753815_key@2x.png"},enableQQ:!0,avatar_cdn:"https://cravatar.cn/avatar/",visitor:!0},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vemoji",(()=>{const i=document.createElement("style");i.innerHTML="\n            #valine .vemoji {\n              width: 40px !important;  /* 根据需要调整宽度 */\n              height: 40px !important; /* 根据需要调整高度 */\n            }\n          ",document.head.appendChild(i)})),Fluid.utils.waitElementVisible("#valine .vcontent",(()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)}))}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><span>58k</span></div></footer><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script>window.MathJax?(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset(),MathJax.typesetPromise()):window.MathJax={tex:{inlineMath:{"[+]":[["$","$"]]}},loader:{load:["ui/lazy"]},options:{renderActions:{insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach((t=>{let e=t.parentNode;"li"===e.nodeName.toLowerCase()&&e.parentNode.classList.add("has-jax")}))},"",!1]}}},Fluid.events.registerRefreshCallback((function(){"MathJax"in window&&MathJax.startup.document&&"function"==typeof MathJax.startup.document.state&&(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset(),MathJax.typesetPromise())}))</script><script src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/DynamicRibbon.min.js"></script><script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/star.min.js"></script><script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/love.min.js"></script><script src="//cdn.jsdelivr.net/npm/highlight.js@11.5.1/styles/monokai.min.css.js"></script><script src="/js/scrollAnimation.js"></script><script src="/js/loading.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>